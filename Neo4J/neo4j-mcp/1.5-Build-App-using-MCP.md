# Building applications with MCP tools

In the previous lessons, you learned how to set up and use Neo4j MCP tools to explore databases and test queries. Now it‚Äôs time to put everything together and see the real power of MCP tools in action.

One of the most exciting aspects of using MCP tools with AI agents is their ability to work collaboratively. The agent will select the correct tools in sequence, executing them one after another until the task is complete.

You can use this to your advantage by getting the agent to quickly build entire applications for you. This is sometimes called "vibe coding" - where you describe what you want, and the AI figures out how to build it.

Your goal is to** ****instruct Copilot to build a Python program** that allows a user to enter a movie genre and returns the top 5 movies in that genre.

## Setting up environment variables

Before you begin, you‚Äôll need to set up your environment variables for the Neo4j connection.

Create a** **`.env` file in your project directory with the following variables:

text

.env

Copy

```text
NEO4J_URI=bolt://13.222.233.93:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=pane-shortages-packs
```

## The challenge

Ask Copilot to create this application using the following prompt:

text

Copy

```text
Create a simple command line application in python that:

1. Connects to Neo4j using the Neo4j Python driver using environment variables: NEO4J_URI, NEO4J_USERNAME, NEO4J_PASSWORD.
2. Accepts a Genre name as a text input
2. Runs a Cypher statement that produces a list of the top five movies ordered by their imdbRating in descending order.

Rules:

* The query must filer on non-null values
* You must use tools to understand the schema information
* You must validate your Cypher statement on real data from the database before you write it to the application.
```

Copilot will use the MCP tools to:

1. **Explore the database schema** to understand the data structure
2. **Write and test a Cypher query** to ensure it works correctly
3. **Generate the Python application** that uses the Neo4j Python driver
4. **Validate the solution** by running test queries

The power of validation

Notice how the prompt instructs the agent to validate the Cypher statement on real data before creating the application. This is a key practice - the agent will use the** **`read-neo4j-cypher` tool to test queries first, ensuring the final application actually works.

## Testing your application

Once Copilot has built your application, test it by running the program and entering** **Mystery** **as the genre.

If everything works correctly, you should have everything you need to answer the question to complete the challenge.

Probabilistic outputs

The output is probabilistic, so the application structure may vary slightly between runs, but you should get consistent results from the database queries. That‚Äôs the goal of any good data application - reliable, accurate results regardless of how the code is structured.

## Extra credit

Why not ask Copilot to write a unit test for the application?

## Check your understanding

## Testing Your Mystery Genre Application

When you run your Python application and enter** ****"Mystery"** as the genre, which movie should appear as one of the top-rated movies in the Mystery genre?

* [ ] The Matrix
* [ ] Inception
* [ ] The Dark Knight
* [ ] Pulp Fiction
* [ ] 

Plan to Build the Movie Genre App

  Based on /Users/rupeshpanwar/Documents/PProject/AI-Infra/neo4j-mcp/1.5-Build-App-using-MCP.md

---

  üìã Requirements from Document

  Build a Python CLI app that:

1. Connects to Neo4j using environment variables
2. Accepts a Genre name as input
3. Returns top 5 movies in that genre ordered by imdbRating (descending)
4. Filters on non-null imdbRating values

  Rules:

- ‚úÖ Use MCP tools to understand schema
- ‚úÖ Validate Cypher on real data BEFORE writing app
- ‚úÖ Test with "Mystery" genre

---

  üéØ Step-by-Step Plan

  Phase 1: Schema Discovery (Using MCP Tools)

  Goal: Understand how genres are stored in the database

  Steps:

1. ‚úÖ Get all node labels - DONE (Movie, Person, User)
2. ‚úÖ Get Movie properties - DONE (title, imdbRating, tagline, released)
3. üîÑ Find Genre structure:
   - Is there a Genre node?
   - Are genres stored as a property on Movie (e.g., genre: "Mystery" or genres: ["Mystery", "Thriller"])?
   - Is there a relationship like (Movie)-[:IN_GENRE]->(Genre)?

  MCP Tool: read_neo4j_cypher

  Queries I'll run:
  // Check for Genre node
  MATCH (g:Genre)
  RETURN g LIMIT 1

  // Check if Movie has genre property
  MATCH (m:Movie)
  RETURN m.genre, m.genres LIMIT 5

  // Check for IN_GENRE relationship
  MATCH (m:Movie)-[:IN_GENRE]->(g)
  RETURN type(r), labels(g) LIMIT 5

---

  Phase 2: Test Cypher Query (Using MCP Tools)

  Goal: Write and validate the query on real data

  Steps:

1. Write Cypher query based on schema findings
2. Test with "Mystery" genre
3. Verify we get 5 movies
4. Verify they're ordered by imdbRating descending
5. Verify imdbRating is not null

  MCP Tool: read_neo4j_cypher

  Expected Query Pattern (depends on schema):
  // Option A: If genres are stored as relationship
  MATCH (m:Movie)-[:IN_GENRE]->(g:Genre {name: $genreName})
  WHERE m.imdbRating IS NOT NULL
  RETURN m.title, m.imdbRating
  ORDER BY m.imdbRating DESC
  LIMIT 5

  // Option B: If genre is a property
  MATCH (m:Movie)
  WHERE m.genre = $genreName
    AND m.imdbRating IS NOT NULL
  RETURN m.title, m.imdbRating
  ORDER BY m.imdbRating DESC
  LIMIT 5

---

  Phase 3: Create .env File

  Goal: Store Neo4j credentials

  File: /Users/rupeshpanwar/Documents/PProject/AI-Infra/neo4j-mcp/movie_genre_app/.env

  Contents (from your existing .env):
  NEO4J_URI=bolt://localhost:7687
  NEO4J_USERNAME=neo4j
  NEO4J_PASSWORD=Your@Password!@#

  Tool: Write

---

  Phase 4: Create Python Application

  Goal: Build the CLI app

  File: /Users/rupeshpanwar/Documents/PProject/AI-Infra/neo4j-mcp/movie_genre_app/app.py

  Structure:
  #!/usr/bin/env python3
  """
  Movie Genre App - Find top 5 movies by genre
  """

  import os
  from neo4j import GraphDatabase
  from dotenv import load_dotenv

  def get_top_movies_by_genre(driver, genre_name):
      """Query Neo4j for top 5 movies in genre"""
      with driver.session() as session:
          result = session.run(
              """
              [VALIDATED CYPHER QUERY FROM PHASE 2]
              """,
              genreName=genre_name
          )
          return [record.data() for record in result]

  def main():
      # Load environment variables
      load_dotenv()

    uri = os.getenv('NEO4J_URI')
      username = os.getenv('NEO4J_USERNAME')
      password = os.getenv('NEO4J_PASSWORD')

    # Connect to Neo4j
      driver = GraphDatabase.driver(uri, auth=(username, password))

    try:
          # Get user input
          genre = input("Enter a movie genre: ")

    # Query database
          movies = get_top_movies_by_genre(driver, genre)

    # Display results
          print(f"\nTop 5 {genre} movies:")
          for i, movie in enumerate(movies, 1):
              print(f"{i}. {movie['title']} - Rating: {movie['imdbRating']}")

    finally:
          driver.close()

  if __name__ == "__main__":
      main()

  Tool: Write

---

  Phase 5: Create requirements.txt

  Goal: List Python dependencies

  File: /Users/rupeshpanwar/Documents/PProject/AI-Infra/neo4j-mcp/movie_genre_app/requirements.txt

  Contents:
  neo4j==5.15.0
  python-dotenv==1.0.0

  Tool: Write

---

  Phase 6: Test the Application

  Goal: Verify it works with "Mystery" genre

  Steps:

1. Install dependencies:
   cd /Users/rupeshpanwar/Documents/PProject/AI-Infra/neo4j-mcp/movie_genre_app
   pip install -r requirements.txt
2. Run the app:
   python app.py
3. Enter "Mystery" when prompted
4. Verify output shows 5 movies ordered by rating

  Tool: Bash

---

  Phase 7: Create README

  Goal: Document how to use the app

  File: /Users/rupeshpanwar/Documents/PProject/AI-Infra/neo4j-mcp/movie_genre_app/README.md

  Contents:

- Installation instructions
- Usage examples
- Environment setup

  Tool: Write

---

  üöÄ Execution Order

1. Schema Discovery (MCP read queries)
   ‚Üì
2. Test & Validate Cypher (MCP read queries)
   ‚Üì
3. Create .env file
   ‚Üì
4. Create app.py (with validated Cypher)
   ‚Üì
5. Create requirements.txt
   ‚Üì
6. Test with "Mystery" genre
   ‚Üì
7. Create README

---

  üìÅ Final Structure

  /Users/rupeshpanwar/Documents/PProject/AI-Infra/neo4j-mcp/movie_genre_app/
  ‚îú‚îÄ‚îÄ .env                    # Environment variables
  ‚îú‚îÄ‚îÄ app.py                  # Main application
  ‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
  ‚îî‚îÄ‚îÄ README.md              # Documentation

---

  ‚úÖ Success Criteria

  The app should:

- ‚úÖ Accept genre input from user
- ‚úÖ Connect to Neo4j using .env variables
- ‚úÖ Return exactly 5 movies
- ‚úÖ Order by imdbRating (highest first)
- ‚úÖ Filter out null ratings
- ‚úÖ Work with "Mystery" genre for testing

---

  üéØ Ready to Execute?

  I'll start with Phase 1 (Schema Discovery) to find how genres are stored.
